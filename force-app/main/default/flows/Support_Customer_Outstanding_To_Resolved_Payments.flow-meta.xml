<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>2nd e-mail chasing the cusotmer</description>
        <name>Customer_Outstanding_2nd_email_out</name>
        <label>Customer Outstanding 2nd email out</label>
        <locationX>842</locationX>
        <locationY>288</locationY>
        <actionName>Case.Support_Customer_Outstanding_Reply_2_No_Portal_WebEmail</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Set_Third_Field</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Send 3rd oustanding e-mail before setting the case over to resolved.</description>
        <name>Customer_Outstanding_end_3d_email</name>
        <label>Customer Outstanding end 3d email</label>
        <locationX>1106</locationX>
        <locationY>288</locationY>
        <actionName>Case.Support_Customer_Outstanding_Reply_3_No_Portal_Emailfield</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Update_case_to_resolved</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Sends the first Customer OS email</description>
        <name>Send_Customer_OS_Email_first</name>
        <label>Send Customer OS Email first</label>
        <locationX>578</locationX>
        <locationY>288</locationY>
        <actionName>Case.Support_Customer_Outstanding_Reply_1_No_Portal_EmailField</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Set_Second_E_mail_Field</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>53.0</apiVersion>
    <assignments>
        <description>Set Second E-mail Field</description>
        <name>Set_Second_E_mail_Field</name>
        <label>Set Second E-mail Field</label>
        <locationX>578</locationX>
        <locationY>408</locationY>
        <assignmentItems>
            <assignToReference>$Record.NoReply2ndEmailSent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>secondemailsendingDate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_for_2nd_OS_Field</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set 3rd outstanding field</description>
        <name>Set_Third_Field</name>
        <label>Set Third Field</label>
        <locationX>842</locationX>
        <locationY>408</locationY>
        <assignmentItems>
            <assignToReference>$Record.No_Reply_3rd_Email_Sent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>firstEmailSendingDate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Case_with_3rd_OS_Field</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Updates the case to resolved.</description>
        <name>Update_case_to_resolved</name>
        <label>Update case to resolved.</label>
        <locationX>1106</locationX>
        <locationY>408</locationY>
        <assignmentItems>
            <assignToReference>$Record.Channel_For_Resolution__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Web</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Solution__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>We haven&apos;t heard back from you following our couple of reminders and as such this case has now been marked as Resolved. If the case has not been resolved to your satisfaction, If this is incorrect please contact us and we&apos;ll be happy to investigate further. </stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Resolved</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Resolved__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.NoReply1stEmailSent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ResolvedDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.NoReply2ndEmailSent__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NullDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Case_Resolved_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Final_Field_Set</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Checks to see if the status has changed</description>
        <name>Check_status_has_changed</name>
        <label>Check status has changed</label>
        <locationX>182</locationX>
        <locationY>288</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Status_Has_Changed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Status</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Case_When_Customer_OS_Hits</targetReference>
            </connector>
            <label>Status Has Changed</label>
        </rules>
    </decisions>
    <description>Moves Customer Outstanding cases to resolved when they are of the Payments type.
SFAE-413 - Updated Case Record type filter from 0120C000000WIpHQAW (invalid) to 0128e000000Xd0GAAS (Payments_Support)</description>
    <formulas>
        <description>1st email sending date</description>
        <name>firstEmailSendingDate</name>
        <dataType>DateTime</dataType>
        <expression>CASE(
MOD( DATEVALUE({!$Flow.CurrentDateTime}) - DATE( 1900, 1, 7 ), 7 ),
0, {!$Flow.CurrentDateTime} + 3 ,
1, {!$Flow.CurrentDateTime} + 2 ,
2, {!$Flow.CurrentDateTime} + 2 ,
3, {!$Flow.CurrentDateTime} + 2 ,
4, {!$Flow.CurrentDateTime} + 4 ,
5, {!$Flow.CurrentDateTime} + 4 ,
6, {!$Flow.CurrentDateTime} + 3 ,
{!$Flow.CurrentDateTime} + 2
)</expression>
    </formulas>
    <formulas>
        <description>Nulls out the dates</description>
        <name>NullDate</name>
        <dataType>Date</dataType>
        <expression>DATEVALUE(&quot;&quot;)</expression>
    </formulas>
    <formulas>
        <name>ResolvedDate</name>
        <dataType>DateTime</dataType>
        <expression>CASE(
MOD( DATEVALUE( NOW() ) - DATE( 1900, 1, 7 ), 7 ),
0, NOW() + 4 ,
1, NOW() + 3 ,
2, NOW() + 3 ,
3, NOW() + 3 ,
4, NOW() + 5 ,
5, NOW() + 5 ,
6, NOW() + 4 ,
NOW() + 3
)</expression>
    </formulas>
    <formulas>
        <description>Date that the second e-mail is sent</description>
        <name>secondemailsendingDate</name>
        <dataType>DateTime</dataType>
        <expression>CASE(
MOD( DATEVALUE({!$Record.NoReply1stEmailSent__c}) - DATE( 1900, 1, 7 ), 7 ),
0, {!$Record.NoReply1stEmailSent__c}+ 3,
1, {!$Record.NoReply1stEmailSent__c}+ 2,
2, {!$Record.NoReply1stEmailSent__c}+ 2,
3, {!$Record.NoReply1stEmailSent__c}+ 2,
4, {!$Record.NoReply1stEmailSent__c}+ 4,
5, {!$Record.NoReply1stEmailSent__c}+ 4,
6, {!$Record.NoReply1stEmailSent__c}+ 3,
{!$Record.NoReply1stEmailSent__c}+ 2
)</expression>
    </formulas>
    <formulas>
        <description>Sets the 3rd field</description>
        <name>ThirdEmailSendingDate</name>
        <dataType>DateTime</dataType>
        <expression>CASE(
MOD( DATEVALUE( {!$Record.NoReply2ndEmailSent__c} ) - DATE( 1900, 1, 7 ), 7 ),
0, {!$Record.NoReply2ndEmailSent__c}+ 2,
1, {!$Record.NoReply2ndEmailSent__c} + 1,
2, {!$Record.NoReply2ndEmailSent__c} + 1,
3, {!$Record.NoReply2ndEmailSent__c}+ 1,
4, {!$Record.NoReply2ndEmailSent__c}+ 1,
5, {!$Record.NoReply2ndEmailSent__c}+ 3,
6, {!$Record.NoReply2ndEmailSent__c}+ 3,
{!$Record.NoReply2ndEmailSent__c}+ 1
)</expression>
    </formulas>
    <interviewLabel>Support - Customer Outstanding {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Support - Customer Outstanding To Resolved - Payments</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>Update_Case_Null_2nd_e_mail_sent</name>
        <label>Update Case Null 2nd e-mail sent</label>
        <locationX>1106</locationX>
        <locationY>648</locationY>
        <inputAssignments>
            <field>NoReply2ndEmailSent__c</field>
            <value>
                <elementReference>NullDate</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Updates the case when Customer OS is hit</description>
        <name>Update_Case_When_Customer_OS_Hits</name>
        <label>Update Case When Customer OS Hits</label>
        <locationX>50</locationX>
        <locationY>408</locationY>
        <inputAssignments>
            <field>CustomerLastContacted__c</field>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NoReply1stEmailSent__c</field>
            <value>
                <elementReference>firstEmailSendingDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NoReply2ndEmailSent__c</field>
            <value>
                <elementReference>NullDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>No_Reply_3rd_Email_Sent__c</field>
            <value>
                <elementReference>NullDate</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Sets 3rd OS Field</description>
        <name>Update_Case_with_3rd_OS_Field</name>
        <label>Update Case with 3rd OS Field</label>
        <locationX>842</locationX>
        <locationY>528</locationY>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the final set</description>
        <name>Update_Final_Field_Set</name>
        <label>Update Final Field Set</label>
        <locationX>1106</locationX>
        <locationY>528</locationY>
        <connector>
            <targetReference>Update_Case_Null_2nd_e_mail_sent</targetReference>
        </connector>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update For Field</description>
        <name>Update_for_2nd_OS_Field</name>
        <label>Update for 2nd OS Field</label>
        <locationX>578</locationX>
        <locationY>528</locationY>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>518</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Check_status_has_changed</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Customer Outstanding</stringValue>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>0128e000000Xd0GAAS</stringValue>
            </value>
        </filters>
        <filters>
            <field>OwnerId</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>00G4I000005bTVy</stringValue>
            </value>
        </filters>
        <object>Case</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <scheduledPaths>
            <name>X1st_Email_Update</name>
            <connector>
                <targetReference>Send_Customer_OS_Email_first</targetReference>
            </connector>
            <label>1st Email Update</label>
            <offsetNumber>0</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <recordField>NoReply1stEmailSent__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <scheduledPaths>
            <name>X2nd_Email_Update</name>
            <connector>
                <targetReference>Customer_Outstanding_2nd_email_out</targetReference>
            </connector>
            <label>2nd Email Update</label>
            <offsetNumber>0</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <recordField>NoReply2ndEmailSent__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <scheduledPaths>
            <name>X3rd_Email_Update</name>
            <connector>
                <targetReference>Customer_Outstanding_end_3d_email</targetReference>
            </connector>
            <label>3rd Email Update</label>
            <offsetNumber>0</offsetNumber>
            <offsetUnit>Minutes</offsetUnit>
            <recordField>No_Reply_3rd_Email_Sent__c</recordField>
            <timeSource>RecordField</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
